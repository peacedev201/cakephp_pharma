(function(a,b){"function"===typeof define&&define.amd?define("jquery mooFileUploader mooBehavior mooAlert mooPhrase mooAjax mooGlobal tinyMCE".split(" "),b):"object"===typeof exports?module.exports=b(require("jquery")):a.mooDocument=b()})(this,function(a,b,l,m,e,g,h,k){var p=function(c,n){""==c&&new b.fineUploader({element:a("#document_file_upload")[0],multiple:!1,text:{uploadButton:'<div class="upload-section"><i class="material-icons">photo_camera</i>'+e.__("drag_file")+"</div>"},validation:{allowedExtensions:n.split(","),
sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/document/documents/upload"},callbacks:{onError:h.errorHandler,onComplete:function(c,b,d){jQuery.isEmptyObject(d)||(file=jQuery(this.getItemByFileId(c)),element_delete=a('<a href="javascript:void(0);">'+e.__("delete")+"<a/>"),file.find(".qq-upload-status-text").append(element_delete),element_delete.click(function(){g.post({url:mooConfig.url.base+"/documents/delete_file/"+a("#document_file").val()},function(a){});a("#document_file").val("");
a("#original_filename").val("");a("#document_file_upload .qq-upload-button").show();file.remove()}),a("#document_file").val(d.document_file),a("#original_filename").val(d.original_filename),a("#document_file_upload .qq-upload-button").hide())}}});a("#document_button").click(function(){button=a(this);button.addClass("disabled");null!==k.activeEditor&&a("#description").val(k.activeEditor.getContent());g.post({url:mooConfig.url.base+"/documents/save",data:jQuery("#createForm").serialize()},function(b){b=
a.parseJSON(b);1==b.result?window.location=mooConfig.isApp?b.href+"?app_no_tab=1":""!=c?c:mooConfig.url.base+"/documents":(button.removeClass("disabled"),a(".error-message").show(),a(".error-message").html(b.message))});return!1});text_upload_button=""!=e.__("drag_photo")?'<div class="upload-section"><i class="material-icons">photo_camera</i>'+e.__("drag_photo")+"</div>":'<div class="upload-section"></div>';new b.fineUploader({element:a("#document_thumnail")[0],multiple:!1,text:{uploadButton:text_upload_button},
validation:{allowedExtensions:["jpg","jpeg","gif","png"],sizeLimit:mooConfig.sizeLimit},request:{endpoint:mooConfig.url.base+"/documents/upload_avatar"},callbacks:{onError:h.errorHandler,onComplete:function(c,b,d){a("#document_thumnail_preview > img").attr("src",d.thumb);a("#document_thumnail_preview > img").show();a("#thumbnail").val(d.file)}}});f()},f=function(){a(".deleteDocument").unbind("click");a(".deleteDocument").click(function(){var c=a(this).data();c=mooConfig.isApp?mooConfig.url.base+"/documents/delete/"+
c.id+"?app_no_tab=1":mooConfig.url.base+"/documents/delete/"+c.id;m.confirm(e.__("delete_document_confirm"),c)})},q=function(){a(window).ready(function(){var c=window.innerHeight-50;650<window.innerHeight&&(c=650);768>window.innerWidth&&(c=300);a("#iframe_preview").attr("height",c)});f()};return{initCreateDocument:function(a,b){p(a,b)},initViewDocument:function(){q()},initOnListing:function(){l.initMoreResults();f()}}});